<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam&display=swap" rel="stylesheet">

  <title>Online Quiz</title>
  <style>
    :root {
      --primary: #00b4d8;
      --background: #1a1a2e;
      --card-bg: #252841;
      --text-light: #e0e0e0;
      --accent: #0077b6;
      --danger: #ff4d6d;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--background);
      color: var(--text-light);
      line-height: 1.6;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .landing {
      background: linear-gradient(to right, #00b4d8, #0077b6);
      color: #fff;
      padding: 100px 20px;
      text-align: center;
    }

    .landing h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .landing p {
      font-size: 18px;
      margin-bottom: 40px;
    }

    .landing button {
      background: #fff;
      color: #0077b6;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .landing button:hover {
      background: #e0e0e0;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: var(--card-bg);
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      margin-top: -60px;
    }

    h2 {
      text-align: center;
      font-size: 32px;
      margin-bottom: 30px;
      color: var(--primary);
    }

    input[type="text"] {
      width: 100%;
      padding: 14px;
      margin-bottom: 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
    }

    button {
      display: block;
      width: 100%;
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover:not(:disabled) {
      background: var(--accent);
    }

    button:disabled {
      background: #888;
      cursor: not-allowed;
    }

    .question {
      background: #2e3357;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .question h4 {
      margin-bottom: 12px;
      color: #fff;
    }

    label {
      display: block;
      margin-bottom: 10px;
      cursor: pointer;
      padding-left: 4px;
      color: #ccc;
    }

    #timer {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 20px;
      color: var(--danger);
    }

    @media (max-width: 600px) {
      .landing h1 {
        font-size: 32px;
      }

      .landing p {
        font-size: 16px;
      }
    }
    .malayalam-text {
      font-family: 'Noto Sans Malayalam', sans-serif;
    }
  </style>
</head>

<body>

  <!-- Landing Section -->
  <section class="landing" id="landing">
    <h1>‡¥ï‡µä‡¥ü‡¥™‡µç‡¥™‡¥®‡¥ï‡µç‡¥ï‡µΩ - ‡¥Ö‡¥ñ‡¥ø‡¥≤ ‡¥ï‡µá‡¥∞‡¥≥ ‡¥ì‡µ∫‡¥≤‡µà‡µª ‡¥ï‡µç‡¥µ‡¥ø‡¥∏‡µç</h1>
    <p>Test your knowledge. Stay focused. You only get one shot.</p>
  </section>

  <!-- Main Quiz Container -->
  <div class="container" id="quiz-form">
    <h2>üß† Quiz Entry</h2>
    <div id="start-screen">
      <input type="text" id="name" placeholder="Enter your name" />
      <input type="text" id="username" placeholder="Enter your Whatsapp number" />
      <p style="margin-top: -20px;margin-bottom: 20px; padding-top: 0;"><i>Make Sure your Whatsapp Number Correct. Other wise your score will be lost.</i></p>
      <button id="startBtn">Start Quiz</button>
    </div>

    <div id="quiz-screen" style="display:none;">
      <div id="timer"></div>
      <div id="quizContainer"></div>
      <button id="submitBtn">Submit Answers</button>
    </div>
  </div>
<script>
    // Malayalam Unicode block: U+0D00 to U+0D7F
    const malayalamRegex = /[\u0D00-\u0D7F]/;

    document.querySelectorAll('p, span, div, h1, h2, h3, h4, h5, h6').forEach(el => {
      if (malayalamRegex.test(el.textContent)) {
        el.classList.add('malayalam-text');
      }
    });
  </script>
  <!-- Firebase & Logic -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBXJ_RnfjUDi7qPDATWVnS5lSFw6jVRYgo",
      authDomain: "shopping-e284c.firebaseapp.com",
      databaseURL: "https://shopping-e284c-default-rtdb.firebaseio.com",
      projectId: "shopping-e284c",
      storageBucket: "shopping-e284c.appspot.com",
      messagingSenderId: "248274428739",
      appId: "1:248274428739:web:fc30dd9eb1ef83f610c5f6",
      measurementId: "G-ZXZCK9BW7T"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let questions = [];
    let warned = false;
    let quizSubmitted = false;
    let timerInterval = null;
    const DURATION = 70;

    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const startBtn = document.getElementById('startBtn');
    const submitBtn = document.getElementById('submitBtn');
    const quizCon = document.getElementById('quizContainer');
    const timerEl = document.getElementById('timer');
    const landing = document.getElementById("landing");



    startBtn.addEventListener('click', () => {
      landing.style.height = "100px";
      landing.style.visibility = "hidden";
      const name = document.getElementById('username').value.trim();
      const roll = document.getElementById('name').value.trim();
      if (!name || !roll) return alert('Name & Roll Number required.');
      const lockKey = `quiz_done_${name}_${roll}`;
      if (localStorage.getItem(lockKey)) return alert('Our records show you‚Äôve already taken the quiz.');

      startScreen.style.display = 'none';
      quizScreen.style.display = 'block';
      loadQuestions();
      startTimer(DURATION);
    });

    function loadQuestions() {
      if (localStorage.getItem("done")) {
        // If "username" key exists in localStorage
        window.location.href = "/already.html";
      } else {
        // console
        // ;
      }
      quizCon.innerHTML = '';
      questions = [];
      db.ref('questions').once('value', snap => {
        snap.forEach(child => {
          const q = child.val();
          q.id = child.key;
          questions.push(q);
          quizCon.innerHTML += `
            <div class="question">
              <h4>${q.question}</h4>
              ${['opt1', 'opt2', 'opt3', 'opt4'].map(opt =>
            `<label>
                   <input type="radio" name="${q.id}" value="${opt}">
                   ${q[opt]}
                 </label>`
          ).join('')}
            </div>`;
        });
      });
    }

    function startTimer(sec) {
      let t = sec;
      timerEl.textContent = formatTime(t);
      timerInterval = setInterval(() => {
        t--;
        timerEl.textContent = formatTime(t);
        if (t < 0) autoSubmit();
      }, 1000);
    }

    function formatTime(s) {
      const m = Math.floor(s / 60), sec = s % 60;
      return `Time Remaining: ${m}:${sec < 10 ? '0' : ''}${sec}`;
    }

    function autoSubmit() {
      clearInterval(timerInterval);
      if (!quizSubmitted) {
        submitQuiz();
      }
    }

    submitBtn.addEventListener('click', submitQuiz);
    function submitQuiz() {
      localStorage.setItem("done", "true");
      if (quizSubmitted) return;
      quizSubmitted = true;
      clearInterval(timerInterval);
      submitBtn.disabled = true;

      const name = document.getElementById('username').value.trim();
      const roll = document.getElementById('name').value.trim();
      let score = 0;
      questions.forEach(q => {
        const sel = document.querySelector(`input[name="${q.id}"]:checked`);
        if (sel?.value === q.answer) score++;
      });

      const lockKey = `quiz_done_${name}_${roll}`;
      db.ref('responses/' + name).set({ roll, score })
        .then(() => {
          localStorage.setItem(lockKey, 'true');
          window.location.href = "/submited.html";
          quizCon.innerHTML = '';
        })
        .catch(err => {
          console.error(err);
          alert('Submit failed ‚Äî check console.');
        });
    }
  </script>
</body>

</html>